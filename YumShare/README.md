# Yumshare
#### Video Demo: https://youtu.be/IEB486n9h6g
#### Description:
Webapp to store and organize a user's personal recipes.
### citations.txt
This is a file containing citation for sources of people and things that helped in the making of this project.
## /uploads
This folder is to store images users have uploaded. The images are used for either profile pictures or recipe images.
## /static
This folder holds a stylesheet and images for the web app.
### static/styles.css
This is for some of the styling for all the web app's pages.
### static/images
This image folder is used to store images for icons like categories, all recipes, and add recipes. Also stored here are default images for profile pictures or recipe images.
### recipe.db
This is the web app database for storing information on users, profiles, recipes, and categories. 
The user table has a primary id which is autoincrements and not null. It also stores usernames (which must be unique), password hashes, first names, and last names. 
The profile table stores the user's profile information such as profile picture URL (which is defaulted to a default image and not null), bio, favorite food, and country. Also in the profile table is the user id (foreign key referencing the users table) and an id primary key.  
The categories table stores the name of the category, user id (a foreign key that references the users table), and id (primary key).
The rec_cat table is a junction table for connecting recipes and categories. In this table is a primary id, user id (user_id), category id (cat_id), and recipe id (rec_id). The category id is a foreign key that references the categories table. The recipe id is a foreign key that references the recipes table. And user id is a foreign key that references the users table. 
## /templates
This folder is for all the app templates for different pages.
### templates/register.html
This page ('register.html') is page is a form to register a user and create an account, which must be done to then log in and use the web app. The first input is a username which will then be used to log in and is a required field. The username must not be taken by another user. The next input is for the users last name and is optional. The next input is a required password field that will be used to log in. The password input must be at least 8 characters long and include at least one uppercase letter, at least one lowercase letter, at least one number, and at least one symbol. The site will not allow you to register until this password meets these parameters. If the user forgoes one or more of these parameters the page will show which parameter(s) have not been met and clear the inputs to try again. The next input is to confirm the password to help prevent the user from typing in the wrong password. Next is a submit button which will submit the form to the app route "/register" via the 'POST' request method. Next is just a link to the login page in case the user already has an account and doesn't need to register.
### templates/login.html
This page is a form for the user to log into their account. It consists of an input for their username, password, and a submit button. Also, a link to the register page in case the user does not already have an account. If the user enters invalid information the page is redirected to an apology page which tells them the information they entered is invalid or that they have forgot to provide an input to one of the fields. This form submits to '/login' via 'POST'.
### templates/index.html
The main page is the page is the page that the user will be brought to first upon logging in to their account. On the page is a random food-themed quote generator, which is generated using a button. Also on the page are links to redirect the user to '/all_recipes' and '/categories. The random quote is generated using JavaScript. There is an array of objects in which each object includes a quote and the author of each quote. When the page is loaded or the button is clicked a random number is generated and this number is used to access a random index in the quotes array and this random quote is then displayed to the html.
### templates/all_recipes.html
This page is to display the recipes the user has uploaded as well as offers access to the recipes by clicking on them. This is using a form with each recipe being a submit button with the value of their recipe name. Also has the option to add a new recipe. At the top of the screen is a dropdown menu with options to sort how the user's recipes are displayed either by new to old, old to new, or alphabetically. The default sort option is from new to old. Next, we have a button to add a recipe and upon clicking will redirect the user to the '/add_recipe' page. Next, are the user's recipes displayed in an icon-type fashion with either the default recipe image or a user-uploaded image with the name of the recipe underneath. Recipes are ordered by the selected sorting option. The form submits to '/all_recipes'.
### templates/add_recipe.html
This page is a form to add a new recipe. It has a text input for the recipe name, text areas for recipe description, ingredients, instructions, notes, amount of servings, prep-time, cook-time, a drop-down menu to attach the recipe to one of the user's categories, and a submit button to submit this form to '/add_recipe' via 'POST'.
### templates/recipe.html
This page is to displays a given recipe's information such as name, description, category, prep time, cook-time, total time, recipe image, ingredients, instructions, and notes. Also on this page is a link to edit the recipe, a button to delete the recipe, and a link to upload an image of the recipe. The delete button is within a form that submits to '/recipe_page' via 'POST'.
### templates/edit_recipe.html
This page is accessed through the recipe's page (recipe.html). On this page is a form with the same inputs as the add recipe page (text input for name, text areas for description, ingredients, instructions, and notes, and drop downs for prep-time, cook-time, total time, and categories), the difference here being the inputs' values are preset with the preexisting values of the recipe but are able to be edited. Ends with a save changes button to submit the information via 'POST' to the route '/edit_recipe'. 
### templates/categories.html
This page is a form containing all categories the user has. On the page, the categories are shown to look like icons. These are each submit buttons which have the value of the recipe's name so when one is clicked the back-end knows which recipe was clicked and can then return with the correct category page. Also on this page is an 'Add category' button which brings the user to a page where they can add a new category. This form submits to '/categories' via 'POST'.
### templates/category_page.html
This page displays all the recipes contained within the specified category shown as an 'icon' with the recipe's name and either an uploaded image of the recipe or the default image. The recipes are submit buttons each with a value of their unique recipe name which tells the back-end which recipe was selected. This form submits to 'category_page' via 'POST'. Also on this page is an 'Add recipe' button which is a link to the route ('/rec_cat') where you can add a recipe to the category. 
### templates/add_category.html
This is a simple page where a user can add a new category. On the page is just a text input and a submit button. The text input is for the name of the new category and the submit button is to submit the new category via 'POST' to '/add_category'.
### templates/rec_cat.html
This page is accessed through a category page ('category.html') by clicking on the 'Add recipe' button. The page is used to quickly add a recipe to a category through that category's page. On the page are icons of all the recipes that the user has uploaded excluding the recipes already in the given category. Clicking on one of these icons adds that recipe to the category and removes it from the category it was in before if it was already in a category. If the user doesn't have any recipes uploaded to add to the category, a message telling as much is displayed. This form submits to '/rec_cat' via 'POST'.
### templates/profile.html
This page is accessed through the profile link in the options drop-down menu at the top write of the layout. The page is the user's unique profile where their name, profile picture, bio, and favorite food are displayed. Also on this page is a link to a page to upload a profile picture and a link to edit the profile information.
### templates/edit_profile.html
This page is accessed through the user's profile page by clicking on the 'Edit profile' link. On this page are inputs for the user's bio, favorite food, country, and a 'Save changes' submit button. If the user already has data for any of these the data is preloaded into the values of the inputs and able to be edited. Submitting this form submits to /edit_profile via 'POST'. 
### templates/upload_image.html
This page is a form used to upload images either a user's profile picture or an image of a user's recipe. It is accessed either through a user's profile ('profile.html') or through a user's recipe ('recipe.html'). Displayed to the user is a form with input for a file chosen from their computer's file system, an upload button to upload the image, and a button to go back to their profile or recipe. The form has the attribute 'enctype' set to 'multipart/form-data' which allows the uploading of files through the form. First in the form is a hidden input field ('{{ form.hidden_tag }}') which renders a unique token (using Flask-WTF) to be submitted with each form. This is to help defend against CSRF (Cross-Site Request Forgery) attacks. Next is a check for errors with the photo input field, which if there is an error the error will display on the user's screen, such as 'Please only upload images'. If the image is successfully uploaded the page will show that it was successful by displaying a message on the page as well as a preview of how the image will appear either on the user's profile or the user's recipe page.
### templates/layout.html
This page serves as the foundation for all of the other templates to build upon. This template links all the templates to stylesheet.css as well as the bootstrap CSS and JavaScript. It also provides a navigation bar at the top of every page, used to navigate the web app. When a user is logged into their account, included on the nav bar are links to routes to go to the homepage ('/'), the all recipes page ('/all_recipes'), and the categories page ('/categories'). Also on the nav bar is a dropdown menu with links to the user's profile ('/profile'), a page to change the user's password ('/change_password'), and the option to log out via '/logout'. If the user is not logged in, included on the nav bar is just a link to a page to register an account ('/register) and a link to a page to log in ('/login'). Also on this file is the Jinja block tags (block main and block title) to insert the other templates on top of this 'base' template.

### templates/change_password.html
This page is a simple form for a user to change their password which routes to '/change_password'. The form contains inputs for the user's current password, their new password, a confirmation of their new password, and a submit button. Underneath the new password input is a message to let the user know what they must include in their password. If a user submits the form and the data in the current password input does not match the user's current password the page redirects to the apology page telling the user that their input was incorrect. If the new password and confirmation do not match, the page also redirects to the apology page telling the user the new password and confirmation password do not match. If their new password does not meet the parameters the page will refresh and show within the form which parameters they have discluded. 
### templates/apology.html
This is a very simple page that is used when a user has made an error. On the page is a message telling the user what error they have made as well as a button which when pressed takes the user to their previous page.

## ./
### app.py
This is the main bulk of the code for the web app including all routes. 
### app.py
This is the main bulk of the code for the web app including all routes. 
#### /register
If the request method is 'GET' it sets first to True to indicate that it is the user's first attempt to register, and there for will display the quick message telling the user what their password must include. Then pass_check is assigned to None because Jinja will have an error if referenced before being assigned to any value. Then it returns and renders the 'register.html' template along with the empty pass_check variable and the first variable.
If the the request method is 'POST' it assigns all the inputs from 'register.html' to variables. If a username, first name, password, or password confirmation are not inputted it redirects to an apology page telling the user to include the missing input with a link back to the register page. Also if the username is already taken or if the password confirmation doesn't match the user is also redirected to the apology page telling the user that the username they have chosen is already taken or their passwords don't match, respectively. The password is then checked if it meets the parameters using the password_check() function from helpers.py. If the password does not meet the parameters, it renders the register template again, with a dictionary of boolean objects to tell JINJA which parameters have not been met, so it can be shown to the user. If the parameters are met, a password hash is generated and the hash along with the user inputs (minus the actual password) are inserted into the database in the users table. Then return redirect to '/'.
#### /login
If the request method is 'GET' it just renders the 'login.html' template. If the request method is 'POST', first it checks if a username and password have been entered. Next, it checks if the username is in the users table in the database and it hashes the password entered and checks it against the password hash in the database where the username is. If either of these return false we return the apology page telling the user the information is invalid. Otherwise, we set the 'session["user_id"] to the user's id so that it remembers who is logged in. We then return redirect to the app's main page ('index.html').
#### '/'
This route just resets the sort session to 'new to old' for the '/all_recipes'  (says how to sort the recipes in this route) route and then just returns and renders the 'index.html' template.
##### /all_recipes
If the request method is 'GET', it checks which sort option is selected and the recipe information is selected and ordered in the specified manner. The sorting method is saved using session['sort']. 'all_recipes.html' is then rendered with the recipe information as well as the sorting method. If the request method is 'POST', it checks if the 'Add recipe' button has been clicked, in which case it redirects to '/add_recipe'. Next, we check if a sorting option was clicked by comparing the sort variable from the form against the session['sort']; if they are different it sets session['sort'] to the new sorting method and redirects to '/all_recipes' via 'GET'. Otherwise, it means a recipe has been clicked in which case it pulls that recipe information from the recipes table in the database, sets the session['recipe'] to the id of the recipe clicked, and returns and redirects to '/recipe_page. 
#### /add_recipe
If the request method is 'GET', the user's categories are selected from the categories table in the database and assigned to a variable. It then returns and renders the 'add_recipe.html' template' along with the categories variable. If the request method is 'POST' the inputs are all assigned to variables along with the date and time of the submission. If a name, ingredients, or instructions are not submitted the program returns the apology page telling the user which input they must include. If the correct inputs are included we add the information included to the recipes table in the database. Also if a category is selected a new row in the junction table rec_cat is added joining the recipe id, category id, and user id. It then returns redirecting to '/all_recipes'.
#### /recipe_page
If the request method is 'GET' the recipe id is accessed from the session['recipe_id'] and assigned to a variable. The recipe's information is then selected from the recipes table in the database using the recipe id. Also if the recipe has a category it is selected from the categories table in the database using the recipe_id and the junction table rec_cat. The total time to prepare the recipe is calculated by adding the cook and prep times. Then it returns and renders the 'recipe.html' template along with variables for the recipe information. If the request method is 'POST' it means the delete button has been clicked and confirmed. First, if the user has uploaded an image for this recipe it is deleted from the filesystem. Next, if there is a category connected to the recipe in the rec_cat table it is deleted. Then, the recipe is deleted from the recipes table. Finally, it returns and redirects to '/all_recipes'.
#### /edit_recipe
If the request method is 'GET', first the user's categories are selected and assigned to a variable to provide the options in the categories dropdown on the HTML. Next, the program checks if the recipe is currently connected to a category in the rec_cat table, which is then pre-selected in the HTML page if there is a connection. Next, the data from the recipe table for the current recipe is selected and assigned to a variable. Finally, it returns and renders the edit_recipe.html template, along with the recipe and category variables which contain the preexisting data for the recipe.
If the request method is 'POST', the data from each input is assigned to a variable. Next, the recipes table is updated with the new information, if there is any. If name, ingredients, or instructions are not included the program returns with an apology page telling the user they must include what they have omitted. If a category is selected the rec_cat table is updated if the recipe was already connected to a category or if there was no connection, a new row is inserted into the table. Finally, it returns and redirects to '/recipe_page'.
#### /categories
If the request method is 'GET', the user's categories are selected and assigned to a variable. Then it returns and renders the template for categories.html along with the categories variable
If the request method is 'POST', the program checks if the 'Add category' input was clicked, if it has been it returns and redirects to '/add_category. Else a category has been clicked in which case, the category's name is assigned to a variable and the categories id is selected from the categories table. The category's id is then assigned to session['category'] so that when redirected the next route knows which recipe to provide. Finally, it returns and redirects to '/category_page', where the recipes contained in the selected category will be shown and available to display.
#### /category_page
This route's only method is 'GET'. Upon being routed the the category name is selected from the categories table in the database, finding the specified category by accessing session['category']. The category name is assigned to a variable. The names and images of the recipes that are connected to this category are then selected and assigned to a variable. Then it returns and renders the 'category_page.html' template, along with the category name variable and recipe images and names. 
#### /add_category
If the request method is 'GET' the program just returns and renders the 'add_category.html' template.
If the request method is 'POST' the new category's name is assigned to a variable and inserted into the categories table in the database. Then it returns and redirects to '/categories'.
#### /rec_cat
If the request method is 'GET' the name, image, and id of the recipes not currently in the given category are selected from the recipes table in the database and assigned to a variable. The name of the current category is also selected and assigned to a variable. Then it returns and renders the 'rec_cat.html' template along with the variables. 
If the request method is 'POST' the id of the recipe clicked is assigned to a variable. The id is known because it is the unique value of the recipe button clicked. If that recipe is already assigned to a category, found in the rec_cat table, that row's cat_id column is updated to the new category. Else the new row is inserted into the rec_cat table, adding the category id, recipe id, and user id. Finally, it returns and redirects back to '/category_page'.
#### '/profile'
This route only supports the request method 'GET'. First, all the data from the profile table in the database for a specific user is selected and assigned to a variable. Next, the first name, last name, and username of the user are selected from the user's table in the database and assigned to a variable. Finally, it returns and renders the 'profile.html' template along with the variable.
#### /edit_profile
If the request method of this route is 'GET', it selects all the data from the profile table in the database and assigns it to a variable. Then it returns and renders the 'edit_profile.html' template along with the variable.
If the request method is 'POST' the values of the new bio, favorite food, and country are assigned to variables. Next, it individually asks if there is data in each variable and if there is the profile table in the database is updated where the user id matches. Then it returns and redirects to '/profile'
#### get_file(filename)
This function is to retrieve and send a certain file from a directory, designated by '/uploads/filename'. Earlier in app.py (line 21) 'UPLOADED_PHOTOS_DEST' is configured to 'uploads' which is a folder in the app's filesystem; this means that 'uploads' is the image's destination. Right below this (line 22) a secret key is configured; this key is for encrypting and decrypting (the image) data which helps increase security by preventing tampering or unauthorized access to the data. Line 29 is setting up a structure to handle and manage uploaded image files. At line 32, 'configure_uploads()' will go through all UploadSets and get their configuration, and store their configuration on the app. At lines 34-41 is a class called UploadForm which takes FlaskForm which is a form with a field to upload files and validators which make sure the file is an image and that the field is not empty. If the validation fails the user gets a message saying what went wrong. Next is a submit button labeled 'Upload' which is used for submitting the form. 
#### /upload_image 
This route is used for uploaded images either for recipes or profile pictures. The variable 'form' is assigned to the 'UploadForm()' class defined at line 34. If the form is uploaded and valid, the uploaded photo is saved using the 'photos' object and assigns the filename to a variable. Then it generates a URL for accessing the uploaded file using on the function 'get_file' (defined at line 287) with the filename. Then if the upload is for a profile picture, it checks if the user already has a profile picture, in which case the old profile picture is deleted. Then the profile table in the database is updated with the new file URL. If the upload is for a recipe image, it checks if the recipe already has an image uploaded in which case the old image is deleted. Next, the recipes table in the database is updated with the new file URL. If the upload fails validation 'file_url' is assigned to None which is to tell that the upload has failed. The type of upload being attempted is saved to a variable from 'session["upload_type"]' which will either be 'profile' or 'recipe'. Finally, it returns and renders the 'upload_image.html' template along with the form, file_url, and upload type. 
#### /change_password
If the request method is 'GET', the 'first' variable is assigned 'True' to tell the page that it is the user's first attempt at changing their password. Next 'pass_check' is assigned 'None' to avoid references a variable with no assignment. Finally, it returns and renders the 'change_password.html') template along with the two variables.
If the request method is 'POST' the inputs from the 'change_password.html' template are assigned to variables. Also, the user's current password hash is selected from the database and assigned to a variable. Next, it compares the real current password (hash) against what the user has inputted as their current password. If the passwords don't match it returns the apology function telling the user they typed the incorrect password. Next, it checks if the new password and the password confirmation match and if they don't it returns the apology, telling the user the passwords do not match. Next, it checks if the password meets the parameters using the 'password_check()' function from helpers.py which returns a dictionary with whether the password passed or failed and which parameters it passed or failed and assigns the values to a variable. If the password meets the parameters a new hash is generated and saved to the database. If the password does not meet the parameters, the variable 'first' is assigned the value of 'False' to tell the template it is no longer the user's first attempt. Then it returns and renders the 'change_password.html' template again along with the 'first' variable and the variable which holds which password parameters have or have not been met.
### helpers.py
This file contains functions to help with aspects of the app.
#### apology(message)
This function is used when a user has made an error. As an argument, it takes a message telling the user what error they have made. When called it returns and renders the 'apology.html' template which tells the user the error message.
#### login_required(f)
This function is to make sure a user is logged in before it is given access to certain routes. If the user is not logged in they are redirected to '/login'.
#### password_check(password)
This function is used to check if a password input includes certain parameters. The password is checked if it has at least 8 characters, and includes at least one numeric digit, an uppercase letter, a lowercase letter, and a symbol. Each check is saved as a boolean variable, 'False' if it failed and 'True' if it passed. If all variables are 'True' and therefore passed, a final variable ('password_ok') is declared 'True' or 'False' if any failed. Finally, the function returns with an object of all the variables showing, which parameters have been met and which have failed.